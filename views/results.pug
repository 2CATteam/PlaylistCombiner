html
	head
		title= session.name + " - Spotify Guessing Game"
		meta(charset="utf-8")
		meta(name="description", content="A game where you guess who listens to what Spotify songs")
		meta(name="viewport", content="width=device-width, initial-scale=1.0")
		link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css", rel="stylesheet", integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH", crossorigin="anonymous")
		link(rel="stylesheet", type="text/css" href="/styles.css")
	body 
		.d-flex.justify-content-center.bg-success.p-5.min-vh-100
			.d-flex.w-100.justify-content-center.align-items-center.p-5#wrapContainer.bg-light.rounded-5
				.d-flex.flex-column
					h2.text-align-center Your score:
					h2.text-align-center= `${words.filter((filled_songs) => filled_songs.correct).length}/${filled_songs.length}`
					hr.m3
					each song, idx in filled_songs 
						.d-flex.flex-column.align-items-stretch.guess-div(style="min-width: 456px")
							h3= "Song #" + (idx + 1)
							!= song.song_html
							p.d-none= song.song_data
							p(class=song.correct ? "text-success" : "text-danger")= "Your guess: " + song.given_answer.name
							p(class=song.correct ? "text-success" : "text-danger")= "Answer: " + song.correct_answer_string
							hr.m-3
					button.btn.btn-primary(onclick="savePlaylist()") Save combined playlist to Spotify!
		script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous") 
		script.
			function savePlaylist() {
				//TODO: This
			}

			function getRequest(url, header) {
				return new Promise((res, rej) => {
					let submitReq = new XMLHttpRequest()
					let loaded = function() {
						if (this.status > 399) {
							rej(this)
						} else {
							res(this)
						}
					}
					submitReq.addEventListener("load", loaded);
					submitReq.open("GET", url)
					for (let i in header) {
						submitReq.setRequestHeader(i, header[i])
					}
					submitReq.send()
				})
			}

			window.onload = () => {
				let token = getCookie("spotify_token")
				let refresh_token = getCookie("refresh_cookie")
				if ((!token) && refresh_token) {
					console.log("Trying to refresh token")
					getRequest(`/${session.id}/refresh_token`).then((response) => {
						console.log(response)
						if (response.status == 200) {
							console.log(response.responseText)
							location.reload()
						} else {
							console.error(response.responseText)
						}
					}).catch((response) => {
						console.error(response.responseText)
					})
				}
			}
			